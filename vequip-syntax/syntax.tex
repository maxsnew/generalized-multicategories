\documentclass{article}

\usepackage[margin=1in]{geometry}
\usepackage{tikz-cd}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathpartir}

\begin{document}

\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}
\newcommand{\pto}{\nrightarrow}
\newcommand{\pfrom}{\nleftarrow}
\newcommand{\vcat}{\mathcal}
\newcommand{\cat}{\mathbb}
\newcommand{\vtkmnd}{\mathbb{K}\text{Mod} (\vcat{V},T)}
\newcommand{\rmod}{\text{RMod}}
\newcommand{\lmod}{\text{LMod}}

\newcommand{\id}{\text{id}}
\newcommand{\when}{\text{when}\,}
\newcommand{\sort}{\,\text{sort}}
\newcommand{\ctx}{\,\text{context}}
\newcommand{\pipe}{\,|\,}

\title{Judgment Theory: An Syntax for Virtual Equipments}
\author{Max S. New}

\maketitle

In what follows we present an internal language for virtual equipments
(TODO: cite Crutwell-Shulman, Leinster, Hermida)
%
Despite sounding slightly obscure, virtual equipments are quite useful
as ``a good place to do category theory'', that is a virtual equipment
has enough structure to define internal notions of category,
multicategory and polycategory.
%
From a type-theoretic angle and a sprinkle of Curry-Howard-Lambek
ideology, we can also see a virtual equipment as a ``good place to
study type theories'' and so we call the type theory ``judgment
theory''.

The following figures present the basic formation, primitive and
admissible and equality rules of a type theory we call judgment
theory, an internal language for virtual equipments.
%
Note that contra Crutwell-Shulman, we define a virtual equipment to be
a virtual double category with all restrictions, whereas they
additionally require the category to have all \emph{units}.
%
Judgment theory has 4 central concepts, which we will refer to
sometimes using type theoretic and at other times category-theoretic
terminology.
%
In type theoretic terminology, judgment theory has \emph{sorts} $\cat
C, \cat D, \cat E$, and \emph{types} $A,B,C$ which have a given sort
and are also \emph{parameterized} by an object of some other sort, and
so can also be thought of as \emph{functions} with input and output
sorts.
%
Next there are \emph{judgments} $P,Q,R,S$ which are parameterized by
two variables.
%
In $\alpha^o:\cat C;\beta : \cat D \pipe R$, we say $R$ depends on
$\alpha$ \emph{contravariantly} and in $\beta$ \emph{covariantly}.
%
Finally, we have \emph{terms} $s,t,u$ that are elements of some
judgment $R$ but are also parameterized by elements of some other
judgments which are given by a \emph{context} $\Phi$, which is a
``compatible string'' of judgments where the covariant variable of one
judgment is the same as the contravariant variable of the next.
%
Since these terms are parameterized by other terms, we can see these
as \emph{inference rules} for the judgments.

At other times we will want to think of these using set-theoretic
terminology, in which case we have sets $\cat C,\cat D, \cat E$,
functions/elements $A,B,C$, \emph{spans} $R,\ldots$ and morphisms of
spans $s,t,u$.
%
Finally when we develop multicategory theory we will use
category-theoretic terminology, in which the structure is most
familiar and we have categories, objects/functors,
\emph{profunctors}/bimodules and 2-cells/homomorphisms of bimodules.


\begin{figure}
  \begin{mathpar}
    \cat C \sort\\
    \inferrule*[right=Object/Type-formation]
    {\cat C \sort \and \cat D \sort}
    {\alpha : \cat C \vdash A : \cat D}\\

    \inferrule*[right=Relation/Judgment/Profunctor-formation]
    {\cat C \sort \and \cat D \sort}
    {\alpha^{o}:\cat C; \beta : \cat D \pipe R}

    \inferrule*[right=Context-formation]
    {\cat C \sort \and \cat D \sort}
    {\alpha^{o}:\cat C ; \beta:\cat D\sort \pipe \Phi \ctx}

    \inferrule*[right=Element/Term/Arrow-formation]
    {\alpha^o:\cat C; \beta : \cat D \pipe \Phi\and
      \alpha^o:\cat C; \beta : \cat D \pipe R}
    {\alpha^{o}:\cat C;\beta : \cat D \pipe \Phi \vdash t : R}

    \inferrule*[right=Substitution-formation]
    {\alpha : \cat C \vdash A : \cat C'\\
      \beta : \cat D \vdash B : \cat D'\\
      \alpha^o : \cat C; \beta : \cat D \pipe \Phi\\
      \alpha'^o : \cat C'; \beta' : \cat D' \pipe \Psi}
    {A;B \pipe \Phi\vdash \vec t : \Psi}
  \end{mathpar}
  \caption{Formation Rules of Judgment Theory}
\end{figure}

\begin{figure}
  \begin{mathpar}
    \inferrule*[right=]
    {~}
    {\alpha : \cat C \vdash \alpha : \cat C}

    \inferrule*[right=*]
    {\alpha : \cat C \vdash B : \cat D\and
    \beta : \cat D \vdash A : \cat E}
    {\alpha : \cat C \vdash A[B/\beta] : \cat E}\\

    \inferrule*[right=Restriction*]
    {\alpha^o : \cat C;\beta : \cat D \pipe R\and
      \alpha' : \cat C' \vdash A : \cat C\and
      \beta' : \cat D' \vdash B : \cat D'}
    {\alpha'^o : \cat C';\beta':\cat D' \pipe R[A/\alpha,B/\beta]}\\

    \inferrule
    {~}
    {\alpha^o : \cat C ; \alpha : \cat C \pipe \cdot}

    \inferrule
    {\alpha^o : \cat C; \beta : \cat D \pipe \Phi\and
      \beta^o : \cat D; \gamma : \cat E\pipe R}
    {\alpha^o : \cat C : \gamma : \cat E \pipe \Phi, \phi : R}

    \inferrule*[right=*]
    {\alpha^o : \cat C; \beta : \cat D \pipe \Phi\and
    \beta^o : \cat D; \gamma : \cat E \pipe \Psi}
    {\alpha^o : \cat C; \gamma : \cat E \pipe \Phi, \Psi}\\

    \inferrule*[right=]
    {\Phi \vdash t : R[A/\alpha,B/\beta]}
    {A;B \pipe \Phi \vdash t/\phi : (\phi : R)}

    \inferrule*[right=]
    {A;B \pipe \Psi \vdash \vec t : \Phi \and
      B;C \pipe \Psi' \vdash s : R[B/\beta, C/\gamma]}
    {A;C \pipe \Psi,\Psi' \vdash \vec t, s/\phi : (\Phi, \phi : R)}

    \inferrule*[right=*]
    {A;B \pipe \Psi \vdash \vec t : \Phi \and
    B;C \pipe \Psi' \vdash \vec s : \Phi'}
    {A;C \pipe \Psi,\Psi' \vdash \vec t, \vec s : \Phi,\Phi'}
    \\

    \inferrule*[right=]
    {~}
    {\alpha^o;\beta\pipe \phi : R \vdash \phi : R}
    
    \inferrule*[right=*]
    {A;B \pipe \Psi \vdash \vec s : \Phi\and
      \alpha'^o : \cat C'; \beta' : \cat D' \pipe \Phi \vdash t : R
    }
    {\alpha^o:\cat C; \beta : \cat D \pipe \Psi \vdash t[\vec s] : R[A/\alpha',B/\beta']}
  \end{mathpar}
  \caption{Basic Rules of Judgment Theory, starred rules are
    admissible, non-starred are primitive}
\end{figure}
\begin{figure}
  \begin{mathpar}
    \begin{array}{rcl}
      A[\alpha/\alpha] &=& A\\
      A[B/\beta][C/\gamma] & = & A[B[C/\gamma]/\beta]\\\\
      
      R[\alpha/\alpha,\beta/\beta] &=& R\\
      R[\alpha'.A/\alpha,\beta'.B/\beta][A'/\alpha',B'/\beta'] & = &
      R[A[A'/\alpha']/\alpha,B[B'/\beta']/\beta]\\\\
      \Phi,\cdot &=& \Phi\\
      \cdot,\Phi &=& \Phi\\
      (\Phi,\Psi),\Theta &=& \Phi,(\Psi,\Theta)\\\\
      (\vec t,\vec s),\vec u &=& \vec t, (\vec s, \vec u)\\\\
      t[\phi_1/\phi_1,\ldots\phi_n/\phi_n] &=& t\\
      t[\Psi_1.s_1/\phi_1,\ldots,\Psi_n.s_n/\phi_n][\vec u_1/\Psi_1,\ldots,\vec u_n/\Psi_n] &=& t[s_1[\vec u_1/\Psi_1]/\phi_1,\ldots,s_n[\vec u_n/\Psi_n]/\phi_n]\\
    \end{array}
  \end{mathpar}  
  \caption{Algebraic Properties of Basic Rules}
\end{figure}

\begin{figure}
  \begin{mathpar}
    \inferrule*[right=Hom-Formation]
    {\beta : \cat D \vdash A : \cat C\and
    \gamma : \cat E \vdash A' : \cat C}
    {\beta^o : \cat D;\gamma : \cat E \pipe A \to_{\cat C} A'}

    \inferrule*[right=Hom-Introduction]
    {~}
    {\alpha^o : \cat C, \alpha : \cat C | \cdot \vdash \id_{\alpha} : \alpha \to_{\cat C} \alpha}

    %% \inferrule*[right=Hom-Left (Sequent Style)]
    %% {\alpha^o,\beta|\Phi,\phi : R[\delta/\delta_1], \psi : S[\delta/\delta_2],\Psi \vdash Q }
    %% {\alpha^o,\beta|\Phi,\phi : R, \chi : \delta_1 \to \delta_2, \psi : S,\Psi \vdash Q}
    
    \inferrule*[right=Hom-Elim]
    {\beta_1^o;\beta_2\pipe\Psi \vdash f : \beta_1 \to_{C} \beta_2\and
      \alpha^o;\beta\pipe \Phi\and
      \beta^o;\gamma\pipe \Phi'\and
      \Phi,\Phi' \vdash g : R}
    {\Phi[\cdot;\beta_1/\beta],\Psi,\Phi'[\beta_2/\beta;\cdot]\vdash \when f = \id_{\beta}.~ g : R[\beta_1/\beta;\beta_2/\beta]}

    \when \id_{\alpha} = \id_{\beta}.~ g \equiv g[\alpha/\beta]

    \inferrule*[right=Hom-$\eta$]
    {...}
    {\beta_1^o : \cat C;\beta_2:\cat C\pipe \Phi \vdash f \equiv \when f = \id_{\alpha} .~ \id_{\alpha} : \beta_1 \to_{\cat C} \beta_2}
  \end{mathpar}
  \caption{Hom Sets}
\end{figure}

\section{Internal Categories}

Next, we introduce the notion of category internal to our syntactic
virtual equipment and the \emph{monoids and modules} translation that
shows that, with the inclusion of hom sets, our syntax is already
suitable for doing syntactic category theory.

The benefits of our syntax become clear when we define internal
categories, functors, profunctors and transformations: the definitions
read exactly as the classical definitions.
\begin{definition}[Internal Category]
  An \emph{(internal) category} consists of
  \begin{enumerate}
  \item A sort $\cat C_0$
  \item A span $\alpha^o:C_0;\alpha' : C_0 \pipe \alpha^o \to_{\cat C} \alpha'$
  \item Identity arrows $\alpha^o : C_0; \alpha : C_0 \pipe \cdot
    \vdash \id_{\alpha} : \alpha \to_{\cat C} \alpha$.
  \item Composition $\alpha_0^o:C_0;\alpha_2:C_0\pipe \phi_0 :
    \alpha_0 \to \alpha_1, \phi_1 : \alpha_1 \to \alpha_2 \vdash
    \phi_1 \circ \phi_0 : \alpha_0 \to \alpha_2$
  \item Satisfying Unitality:
    \[ \id_{\alpha} \circ \phi = \phi = \phi \circ \id_{\alpha'}\]
  \item And Associativity:
    \[ (\phi \circ \psi) \circ \theta = \phi \circ (\psi \circ \theta) \]
  \end{enumerate}
\end{definition}

\begin{definition}[Internal Functor]
  A functor $F$ between internal categories $\cat C$ and $\cat D$ consists of
  \begin{enumerate}
  \item a function on objects $\alpha : \cat C_0 \vdash F_0 : \cat D_0$
  \item a function on arrows $\alpha_0^o : \cat C_0; \alpha_1 : \cat C_0\pipe \phi:\alpha_0 \to_{\cat C} \alpha_1 \vdash F_1(\phi) : F_0(\alpha_0) \to_{\cat D} F_0(\alpha_1)$
  \item that preserves identity:
    \[ F_1(\id_{\alpha}) = \id_{F_0(\alpha)}\]
  \item and composition:
    \[ F_1(\psi \circ \phi) = F_1(\psi) \circ F_1(\phi) \]
  \end{enumerate}
\end{definition}

\begin{definition}[Internal Profunctor]
  A profunctor $R$ between internal categories $\cat C$ and $\cat D$
  consists of
  \begin{enumerate}
  \item A span $\alpha^o : \cat C_0\pipe \beta : \cat D_0 \pipe \alpha \to_{R} \beta$
  \item $C$-composition: $\alpha_0^o:\cat C_0;\beta : \cat D_0\pipe \phi : \alpha_0 \to_{C} \alpha_1, \psi : \alpha_1 \to_{R} \beta \vdash \psi \circ_{R\cat C} \phi : \alpha_0 \to_{R} \beta$
  \item $D$-composition: $\alpha^o:\cat C_0;\beta_1 : \cat D_0\pipe \psi : \alpha \to_{R} \beta, \theta : \beta_0 \to_{\cat D} \beta_1 \vdash \theta \circ_{\cat DR} \psi : \alpha \to_{R} \beta_1$
  \item Satisfying $\cat C$ associativity: $\psi \circ_{R\cat C} (\phi_1 \circ_{\cat C} \phi_0) = (\psi \circ_{R\cat C} \phi_1) \circ_{R\cat C} \phi_0$
  \item Satisfying $\cat C$ unitality: $\psi \circ_{R\cat C} \id_{\alpha} = \psi$
  \item Satisfying $\cat D$ associativity: $(\theta_1 \circ_{\cat D} \theta_0) \circ_{\cat DR} \psi = \theta_1 \circ_{\cat D R} (\theta_0 \circ_{\cat DR} \psi)$
  \item Satisfying $\cat D$ unitality: $\id_{\beta} \circ_{\cat D R} \psi = \psi$
  \item Satisfying mixed associativity: $(\theta \circ_{\cat D R} \psi) \circ_{R \cat C} \phi = \theta \circ_{\cat D R} (\psi \circ_{R \cat C} \phi)$
  \end{enumerate}
\end{definition}

\begin{definition}[Natural Transformation]
  A transformation $F : \Phi \vdash : R$ where each of the sorts in
  $\alpha^o: \cat C;\beta : \cat D \pipe \Phi$ has a given category
  structure and each of the spans in $\Phi$ has a profunctor structure
  on those category structures is given by
  \begin{enumerate}
  \item A function $\Phi \vdash F_1 : \alpha \to_{R} \beta$
  \item Internal Naturality: For any decomposition $\Phi = \Phi_0,\phi
    : \gamma \to_{S} \delta,\psi : \delta \to_{T} \epsilon,\Phi_1$
    where $\gamma : \cat E$ and $\delta : \cat F$, $\epsilon : \cat
    G$, an equality
    \[ \Phi_0,\phi : \gamma\to_{S} \delta_0, \theta : \delta_0 \to_{\cat F} \delta_1,\psi : \delta_1\to_T \epsilon, \Phi_1 \vdash F_1[\theta \circ_{\cat F S} \phi/\phi] = F_1[\psi \circ_{T \cat F}\theta /\psi] \]
  \item Left naturality: If $\Phi = \phi : \alpha \to_{s} \gamma,\Phi'$
    then \[ F_1 \circ_{R\cat C} \psi = F_1[\phi \circ_{S\cat C} \psi]\]
  \item Right naturality: If $\Phi = \Phi', \phi : \gamma \to_{S}
    \beta$, then
    \[ \phi \circ_{\cat D R} F_1 = F_1[\psi \circ \phi/\psi]\]
  \end{enumerate}
\end{definition}


Next we show that internal categories provide us with our first
\emph{model} of judgment type theory by interpreting sorts as
categories, functions as functors, spans as profunctors and 2-cells as
natural transformations.
%
Furthermore, this model can be seen as an \emph{implementation} of
Hom-sets, we translate Judgment type theory with hom sets into
categories internal to judgmental type theory \emph{without} hom sets:
the home sets come from the category structure.

The interpretation of hom-formation and -introduction is obvious, but
elim is more interesting...

\end{document}

%% Local Variables:
%% compile-command: "pdflatex syntax.tex"
%% End:
