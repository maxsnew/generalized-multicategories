\documentclass{article}

\usepackage[margin=1in]{geometry}
\usepackage{tikz-cd}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{mathpartir}
\usepackage{bbm}

\begin{document}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{Definition}
\newcommand{\pto}{\nrightarrow}
\newcommand{\pfrom}{\nleftarrow}
\newcommand{\vcat}{\mathcal}
\newcommand{\cat}{\mathbbm}
\newcommand{\vtkmnd}{\mathbb{K}\text{Mod} (\vcat{V},T)}
\newcommand{\rmod}{\text{RMod}}
\newcommand{\lmod}{\text{LMod}}

\newcommand{\id}{\text{id}}
\newcommand{\for}{\text{for}\,}
\newcommand{\when}{\text{when}\,}
\newcommand{\sort}{\,\text{sort}}
\newcommand{\ctx}{\,\text{context}}
\newcommand{\pipe}{\mathrel{|}}

\title{Judgment Theory: A Syntax for Virtual Equipments and Internal Category Theory}
\author{Max S. New}

\maketitle

In what follows we present an internal language for virtual equipments
(TODO: cite Crutwell-Shulman, Leinster, Hermida)
%
Despite sounding slightly obscure, virtual equipments are quite useful
as ``a good place to do category theory'', that is a virtual equipment
has enough structure to define internal notions of category,
multicategory and polycategory.
%
From a type-theoretic angle and a sprinkle of Curry-Howard-Lambek
ideology, we can also see a virtual equipment as a ``good place to
study type theories'' and so we call the type theory ``judgment
theory''.

The following figures present the basic formation, primitive and
admissible and equality rules of a type theory we call judgment
theory, an internal language for virtual equipments.
%
Note that contra Crutwell-Shulman, we define a virtual equipment to be
a virtual double category with all restrictions, whereas they
additionally require the category to have all \emph{units}.
%
Judgment theory has 4 central concepts, which we will refer to
sometimes using type theoretic and at other times category-theoretic
terminology.
%
In type theoretic terminology, judgment theory has \emph{sorts} $\cat
C, \cat D, \cat E$, and \emph{types} $A,B,C$ which have a given sort
and are also \emph{parameterized} by an object of some other sort, and
so can also be thought of as \emph{functions} with input and output
sorts.
%
Next there are \emph{judgments} $P,Q,R,S$ which are parameterized by
two variables.
%
In $\alpha^o:\cat C;\beta : \cat D \pipe R$, we say $R$ depends on
$\alpha$ \emph{contravariantly} and in $\beta$ \emph{covariantly}.
%
Finally, we have \emph{terms} $s,t,u$ that are elements of some
judgment $R$ but are also parameterized by elements of some other
judgments which are given by a \emph{context} $\Phi$, which is a
``compatible string'' of judgments where the covariant variable of one
judgment is the same as the contravariant variable of the next.
%
Since these terms are parameterized by other terms, we can see these
as \emph{inference rules} for the judgments.

At other times we will want to think of these using set-theoretic
terminology, in which case we have sets $\cat C,\cat D, \cat E$,
functions/elements $A,B,C$, \emph{spans} $R,\ldots$ and morphisms of
spans $s,t,u$.
%
Finally when we develop multicategory theory we will use
category-theoretic terminology, in which the structure is most
familiar and we have categories, objects/functors,
\emph{profunctors}/bimodules and 2-cells/homomorphisms of bimodules.


\begin{figure}
  \begin{mathpar}
    \cat C \sort\\
    \inferrule*[right=Object/Type-formation]
    {\cat C \sort \and \cat D \sort}
    {\alpha : \cat C \vdash A : \cat D}\\

    \inferrule*[right=Relation/Judgment/Profunctor-formation]
    {\cat C \sort \and \cat D \sort}
    {\alpha^{o}:\cat C; \beta : \cat D \pipe R}

    \inferrule*[right=Context-formation]
    {\cat C \sort \and \cat D \sort}
    {\alpha^{o}:\cat C ; \beta:\cat D\sort \pipe \Phi \ctx}

    \inferrule*[right=Element/Term/Arrow-formation]
    {\alpha^o:\cat C; \beta : \cat D \pipe \Phi\and
      \alpha^o:\cat C; \beta : \cat D \pipe R}
    {\alpha^{o}:\cat C;\beta : \cat D \pipe \Phi \vdash t : R}

    \inferrule*[right=Substitution-formation]
    {\alpha : \cat C \vdash A : \cat C'\\
      \beta : \cat D \vdash B : \cat D'\\
      \alpha^o : \cat C; \beta : \cat D \pipe \Phi\\
      \alpha'^o : \cat C'; \beta' : \cat D' \pipe \Psi}
    {A;B \pipe \Phi\vdash \vec t : \Psi}
  \end{mathpar}
  \caption{Formation Rules of Judgment Theory}
\end{figure}

\begin{figure}
  \begin{mathpar}
    \inferrule*[right=]
    {~}
    {\alpha : \cat C \vdash \alpha : \cat C}

    \inferrule*[right=*]
    {\alpha : \cat C \vdash B : \cat D\and
    \beta : \cat D \vdash A : \cat E}
    {\alpha : \cat C \vdash A[B/\beta] : \cat E}\\

    \inferrule*[right=Restriction*]
    {\alpha^o : \cat C;\beta : \cat D \pipe R\and
      \alpha' : \cat C' \vdash A : \cat C\and
      \beta' : \cat D' \vdash B : \cat D'}
    {\alpha'^o : \cat C';\beta':\cat D' \pipe R[A/\alpha,B/\beta]}\\

    \inferrule
    {~}
    {\alpha^o : \cat C ; \alpha : \cat C \pipe \cdot}

    \inferrule
    {\alpha^o : \cat C; \beta : \cat D \pipe \Phi\and
      \beta^o : \cat D; \gamma : \cat E\pipe R}
    {\alpha^o : \cat C : \gamma : \cat E \pipe \Phi, \phi : R}

    \inferrule*[right=*]
    {\alpha^o : \cat C; \beta : \cat D \pipe \Phi\and
    \beta^o : \cat D; \gamma : \cat E \pipe \Psi}
    {\alpha^o : \cat C; \gamma : \cat E \pipe \Phi, \Psi}\\

    \inferrule*[right=]
    {\Phi \vdash t : R[A/\alpha,B/\beta]}
    {A;B \pipe \Phi \vdash t/\phi : (\phi : R)}

    \inferrule*[right=]
    {A;B \pipe \Psi \vdash \vec t : \Phi \and
      B;C \pipe \Psi' \vdash s : R[B/\beta, C/\gamma]}
    {A;C \pipe \Psi,\Psi' \vdash \vec t, s/\phi : (\Phi, \phi : R)}

    \inferrule*[right=*]
    {A;B \pipe \Psi \vdash \vec t : \Phi \and
    B;C \pipe \Psi' \vdash \vec s : \Phi'}
    {A;C \pipe \Psi,\Psi' \vdash \vec t, \vec s : \Phi,\Phi'}
    \\

    \inferrule*[right=]
    {~}
    {\alpha^o;\beta\pipe \phi : R \vdash \phi : R}
    
    \inferrule*[right=*]
    {A;B \pipe \Psi \vdash \vec s : \Phi\and
      \alpha'^o : \cat C'; \beta' : \cat D' \pipe \Phi \vdash t : R
    }
    {\alpha^o:\cat C; \beta : \cat D \pipe \Psi \vdash t[\vec s] : R[A/\alpha',B/\beta']}
  \end{mathpar}
  \caption{Basic Rules of Judgment Theory, starred rules are
    admissible, non-starred are primitive}
\end{figure}
\begin{figure}
  \begin{mathpar}
    \begin{array}{rcl}
      A[\alpha/\alpha] &=& A\\
      A[B/\beta][C/\gamma] & = & A[B[C/\gamma]/\beta]\\\\
      
      R[\alpha/\alpha,\beta/\beta] &=& R\\
      R[\alpha'.A/\alpha,\beta'.B/\beta][A'/\alpha',B'/\beta'] & = &
      R[A[A'/\alpha']/\alpha,B[B'/\beta']/\beta]\\\\
      \Phi,\cdot &=& \Phi\\
      \cdot,\Phi &=& \Phi\\
      (\Phi,\Psi),\Theta &=& \Phi,(\Psi,\Theta)\\\\
      (\vec t,\vec s),\vec u &=& \vec t, (\vec s, \vec u)\\\\
      t[\phi_1/\phi_1,\ldots\phi_n/\phi_n] &=& t\\
      t[\Psi_1.s_1/\phi_1,\ldots,\Psi_n.s_n/\phi_n][\vec u_1/\Psi_1,\ldots,\vec u_n/\Psi_n] &=& t[s_1[\vec u_1/\Psi_1]/\phi_1,\ldots,s_n[\vec u_n/\Psi_n]/\phi_n]\\
    \end{array}
  \end{mathpar}  
  \caption{Algebraic Properties of Basic Rules}
\end{figure}

\begin{figure}
  \begin{mathpar}
    \inferrule*[right=Hom-Formation]
    {\beta : \cat D \vdash A : \cat C\and
    \gamma : \cat E \vdash A' : \cat C}
    {\beta^o : \cat D;\gamma : \cat E \pipe A \to_{\cat C} A'}

    \inferrule*[right=Hom-Introduction]
    {~}
    {\alpha^o : \cat C, \alpha : \cat C | \cdot \vdash \id_{\alpha} : \alpha \to_{\cat C} \alpha}

    %% \inferrule*[right=Hom-Left (Sequent Style)]
    %% {\alpha^o,\beta|\Phi,\phi : R[\delta/\delta_1], \psi : S[\delta/\delta_2],\Psi \vdash Q }
    %% {\alpha^o,\beta|\Phi,\phi : R, \chi : \delta_1 \to \delta_2, \psi : S,\Psi \vdash Q}
    
    \inferrule*[right=Hom-Elim]
    {\beta_1^o;\beta_2\pipe\Psi \vdash f : \beta_1 \to_{C} \beta_2\and
      \alpha^o;\beta\pipe \Phi\and
      \beta^o;\gamma\pipe \Phi'\and
      \Phi,\Phi' \vdash g : R}
    {\Phi[\cdot;\beta_1/\beta],\Psi,\Phi'[\beta_2/\beta;\cdot]\vdash \when f = \id_{\beta}.~ g : R[\beta_1/\beta;\beta_2/\beta]}

    \when \id_{\alpha} = \id_{\beta}.~ g \equiv g[\alpha/\beta]

    \inferrule*[right=Hom-$\eta$]
    {...}
    {\beta_1^o : \cat C;\beta_2:\cat C\pipe \Phi \vdash f \equiv \when f = \id_{\alpha} .~ \id_{\alpha} : \beta_1 \to_{\cat C} \beta_2}
  \end{mathpar}
  \caption{Hom Sets}
\end{figure}

\section{Internal Categories and Category Theory}

Next, we introduce the notion of category internal to our syntactic
virtual equipment and the \emph{monoids and modules} translation that
shows that, with the inclusion of hom sets, our syntax is already
suitable for doing syntactic category theory.

The benefits of our syntax become clear when we define internal
categories, functors, profunctors and transformations: the definitions
read exactly as the classical definitions.
\begin{definition}[Internal Category]
  An \emph{(internal) category} consists of
  \begin{enumerate}
  \item A sort $\cat C_0$
  \item A span $\alpha^o:C_0;\alpha' : C_0 \pipe \alpha^o \to_{\cat C} \alpha'$
  \item Identity arrows $\alpha^o : C_0; \alpha : C_0 \pipe \cdot
    \vdash \id_{\alpha} : \alpha \to_{\cat C} \alpha$.
  \item Composition $\alpha_0^o:C_0;\alpha_2:C_0\pipe \phi_0 :
    \alpha_0 \to \alpha_1, \phi_1 : \alpha_1 \to \alpha_2 \vdash
    \phi_1 \circ \phi_0 : \alpha_0 \to \alpha_2$
  \item Satisfying Unitality:
    \[ \id_{\alpha} \circ \phi = \phi = \phi \circ \id_{\alpha'}\]
  \item And Associativity:
    \[ (\phi \circ \psi) \circ \theta = \phi \circ (\psi \circ \theta) \]
  \end{enumerate}
\end{definition}

\begin{definition}[Internal Functor]
  A functor $F$ between internal categories $\cat C$ and $\cat D$ consists of
  \begin{enumerate}
  \item a function on objects $\alpha : \cat C_0 \vdash F_0 : \cat D_0$
  \item a function on arrows $\alpha_0^o : \cat C_0; \alpha_1 : \cat C_0\pipe \phi:\alpha_0 \to_{\cat C} \alpha_1 \vdash F_1(\phi) : F_0(\alpha_0) \to_{\cat D} F_0(\alpha_1)$
  \item that preserves identity:
    \[ F_1(\id_{\alpha}) = \id_{F_0(\alpha)}\]
  \item and composition:
    \[ F_1(\psi \circ \phi) = F_1(\psi) \circ F_1(\phi) \]
  \end{enumerate}
\end{definition}

\begin{definition}[Internal Profunctor]
  A profunctor $R$ between internal categories $\cat C$ and $\cat D$
  consists of
  \begin{enumerate}
  \item A span $\alpha^o : \cat C_0\pipe \beta : \cat D_0 \pipe \alpha \to_{R} \beta$
  \item $C$-composition: $\alpha_0^o:\cat C_0;\beta : \cat D_0\pipe \phi : \alpha_0 \to_{C} \alpha_1, \psi : \alpha_1 \to_{R} \beta \vdash \psi \circ_{R\cat C} \phi : \alpha_0 \to_{R} \beta$
  \item $D$-composition: $\alpha^o:\cat C_0;\beta_1 : \cat D_0\pipe \psi : \alpha \to_{R} \beta, \theta : \beta_0 \to_{\cat D} \beta_1 \vdash \theta \circ_{\cat DR} \psi : \alpha \to_{R} \beta_1$
  \item Satisfying $\cat C$ associativity: $\psi \circ_{R\cat C} (\phi_1 \circ_{\cat C} \phi_0) = (\psi \circ_{R\cat C} \phi_1) \circ_{R\cat C} \phi_0$
  \item Satisfying $\cat C$ unitality: $\psi \circ_{R\cat C} \id_{\alpha} = \psi$
  \item Satisfying $\cat D$ associativity: $(\theta_1 \circ_{\cat D} \theta_0) \circ_{\cat DR} \psi = \theta_1 \circ_{\cat D R} (\theta_0 \circ_{\cat DR} \psi)$
  \item Satisfying $\cat D$ unitality: $\id_{\beta} \circ_{\cat D R} \psi = \psi$
  \item Satisfying mixed associativity: $(\theta \circ_{\cat D R} \psi) \circ_{R \cat C} \phi = \theta \circ_{\cat D R} (\psi \circ_{R \cat C} \phi)$
  \end{enumerate}
\end{definition}

Next, we show that Profunctors can be restricted by functors

\begin{definition}[Restriction of Profunctors]
  If $\cat C, \cat D, \cat C', \cat D'$ are categories, and $\alpha' :
  \cat C' \vdash F[\alpha'] : \cat C$ and $\beta' : \cat D' \vdash
  G[\beta'] : \cat D$ are functors and $\alpha^o : \cat C;\beta : \cat
  D \pipe \alpha^o \to_{R} \beta$ is a profunctor, then $F[\alpha']
  \to_{R} G[\beta']$ is given the structure of a profunctor by:
  \begin{enumerate}
  \item $\cat C'$ composition:
    \[ \phi : \alpha_0 \to_{\cat C'} \alpha_1, \psi : F[\alpha_1] \to_{R} G[\beta] \vdash \psi \circ_{R\cat C} F_1[\phi] : F[\alpha_1] \to_{R} G[\beta]
    \]
  \item $\cat D'$ composition:
    \[ \alpha^o:\cat \cat C';\beta_1 : \cat D'\pipe \psi : F[\alpha] \to_{R} G[\beta], \theta : \beta_0 \to_{\cat D'} \beta_1 \vdash G[\theta] \circ_{\cat DR} \psi : F[\alpha] \to_{R} G[\beta_1] \]
  \end{enumerate}
\end{definition}

\begin{definition}[Natural Transformation]
  A transformation $F : \Phi \vdash : R$ where each of the sorts in
  $\alpha^o: \cat C;\beta : \cat D \pipe \Phi$ has a given category
  structure and each of the spans in $\Phi$ has a profunctor structure
  on those category structures is given by
  \begin{enumerate}
  \item A function $\Phi \vdash F_1 : \alpha \to_{R} \beta$
  \item Internal Naturality: For any decomposition $\Phi = \Phi_0,\phi
    : \gamma \to_{S} \delta,\psi : \delta \to_{T} \epsilon,\Phi_1$
    where $\gamma : \cat E$ and $\delta : \cat F$, $\epsilon : \cat
    G$, an equality
    \[ \Phi_0,\phi : \gamma\to_{S} \delta_0, \theta : \delta_0 \to_{\cat F} \delta_1,\psi : \delta_1\to_T \epsilon, \Phi_1 \vdash F_1[\theta \circ_{\cat F S} \phi/\phi] = F_1[\psi \circ_{T \cat F}\theta /\psi] \]
  \item Left naturality: If $\Phi = \phi : \alpha \to_{s} \gamma,\Phi'$
    then \[ F_1 \circ_{R\cat C} \psi = F_1[\phi \circ_{S\cat C} \psi]\]
  \item Right naturality: If $\Phi = \Phi', \phi : \gamma \to_{S}
    \beta$, then
    \[ \phi \circ_{\cat D R} F_1 = F_1[\psi \circ \phi/\psi]\]
  \end{enumerate}
\end{definition}

This last definition is probably unfamiliar to the reader that is not
experienced with profunctors.
%
However, we can show that the traditional definition is equivalent to
a natural transformation $\alpha : \cat C_0 \pipe \cdot \vdash
t_{\alpha} : F(\alpha) \to_{\cat D} G(\alpha')$.

\begin{definition}[Traditional Natural Transformation]
  A traditional natural transformation from $\alpha : \cat C_0 \vdash
  F(\alpha) : \cat D_0$ to $\alpha : \cat \vdash G(\alpha') : \cat
  D_0$ consists of
  \begin{enumerate}
  \item A term $\cdot \vdash t_{\alpha} : F(\alpha) \to_{\cat D} G(\alpha)$
  \item Such that
    \[ \phi : \alpha \to_{\cat C} \alpha' \vdash t_{\alpha'} \circ F_1(\phi) \equiv G_1(\phi) \circ t_{\alpha} : F(\alpha) \to_{\cat D} G(\alpha')
    \]
  \end{enumerate}
\end{definition}

\begin{theorem}[Equivalent Presentations of Natural Transformations]
  There is a bijection between traditional natural transformations $t
  : F \to G$ and profunctor homomorphisms $h : \alpha \to_{\cat C}
  \alpha' \vdash F(\alpha) \to_{\cat D} G(\alpha')$ given by
  \begin{enumerate}
  \item From a natural transformation $t$ we define a homomorphism
    $h(t)$ by composing on the $F$ side. The choice of this side is
    arbitrary and we could just as easily have used $G$ since they are
    equal by naturality.
    \[ \phi : \alpha \to_{\cat C} \alpha' \vdash t_{\alpha'} \circ F_1(\phi) : F(\alpha) \to_{\cat D} G_1(\alpha') \]
  \item From a homomorphism $\phi.h$, we define a natural transformation $t(h)$ as
    \[ \alpha \pipe \cdot \vdash h[{\id_{\alpha}}/\phi] \]
  \end{enumerate}
\end{theorem}
\begin{proof}
  First we show that the maps $h(\cdot),t(\cdot)$ actually produce
  homomorphisms and natural transformations.
  \begin{enumerate}
  \item On the left, we need to show $h(t)_{\phi} \circ F_1(\psi) =
    h(t)_{|phi \circ \psi}$. Expanding the definition, we just need
    associativity and functoriality of $F_1$:
    \begin{align*}
      h(t)_{\phi} \circ F_1(\psi) &\equiv (t_{\alpha'} \circ F_1(\phi)) \circ F_1(\psi)\\
      &\equiv t_{\alpha'} \circ F_1(\phi \circ \psi)\\
      &\equiv h(t)_{\phi \circ \psi}
    \end{align*}
    on the right, we use naturality:
    \begin{align*}
      G_1(\theta) \circ h(t)_{\phi} &\equiv G_1(\theta) \circ (t_{\alpha'} \circ F_1(\phi))\\
      &\equiv (t_{\alpha''} \circ F_1(\theta)) \circ F_1(\phi)\\
      &\equiv t_{\alpha''} \circ F_1(\theta \circ \phi)\\
      &\equiv t_{\theta \circ \phi}
    \end{align*}
  \item In the other direction, to prove naturality:
    \begin{align*}
      h[\id_\alpha/\phi] \circ F_1(\psi) &\equiv h[\id_\alpha \circ \psi/\phi]\\
      &\equiv h[\psi/\phi]\\
      &\equiv h[\psi \circ \id_{\alpha'}/\phi]\\
      &\equiv G_1(\psi) \circ h[\id_{\alpha}/\phi]
    \end{align*}
  \end{enumerate}
  Next we seek to prove that the functions are mutually inverse.
  \begin{enumerate}
  \item Round trip for homomorphisms:
    \begin{align*}
      h(t(h))_{\phi} &= t(h)_{\alpha} \circ F_1[\phi]\\
      &= h[\id_{\alpha}] \circ F_1[\phi]\\
      &= h[\id \circ \phi]\\
      &= h[\phi]
    \end{align*}
  \item Round trip for natural transformations uses the fact that
    functors preserve identity.
    \begin{align*}
      t(h(t))_{\alpha} &= h(t)_{\id_{\alpha}}\\
      &= t_{\alpha} \circ F_1[\id_{\alpha}]\\
      &= t_{\alpha} \circ \id_{F_0\alpha}\\
      &= t_{\alpha}
    \end{align*}
  \end{enumerate}
\end{proof}

\subsection{Universal Properties, Internally}

In a sense, the very purpose of category theory is to study universal
properties and so it is essential that our syntax provide a nice
presentation of universal properties.

Fortunately, the central placement of spans/profunctors in our syntax
makes the definition of a functor satisfying a universal property very
natural (should I introduce the unit category earlier?).

\begin{definition}[Right Representability]
  Let $\cat C, \cat D$ be categories and $\alpha^o : \cat C;\beta :
  \cat D \pipe \alpha \to_{Q} \beta$ be a profunctor between them. Then a \emph{right
    representation} of $Q$ consists of
  \begin{enumerate}
  \item A functor $\beta : \cat D \vdash G[\beta] : \cat C$
  \item An ``introduction rule'' homomorphism $\phi: \alpha \to_{Q}
    \beta \vdash I_G[\phi] : \alpha \to_{\cat C} G[\beta]$.
  \item An inverse homomorphism $\psi: \alpha \to_{\cat C} G[\beta]
    \vdash I_G^{-1}[\psi] : \alpha \to_{Q} \beta$. That is, it satisfies
    \begin{align*}
      I_G[I_G^{-1}[\psi]/\phi] &= \psi\\
      I_G^{-1}[I_G[\phi]/\psi] &= \phi
    \end{align*}
  \end{enumerate}
\end{definition}

While this is a fairly standard definition, it is likely unfamiliar to
type theorists, who may be surprised that Right Representability is
essentially the same as the definition of a negative type, which has
an introduction rule, but instead of an inverse, there is an
elimination rule, and the functoriality of the type is not primitive.
Fortunately, we can prove the equivalence between these notions
entirely syntactically.

\begin{definition}[Negative Type]
  A negative type (connective) $N$ between categories $\cat C$,$\cat D$ consists of
  \begin{enumerate}
  \item A judgment it represents $\alpha^o : \cat C;\beta : \cat D
    \pipe \alpha \to_{Q} \beta$
  \item A type $\beta : \cat D \vdash N[\beta] : \cat C$
  \item An ``introduction rule'' $\phi : \alpha \to_{Q} \beta \vdash
    I_N[\phi] : \alpha \to_{\cat C} N[\beta]$ that is a homomorphism
    \emph{on the left}:
    \[ \psi : \alpha' \to_{\cat C} \alpha, \phi : \alpha \to_{Q} \beta \vdash I_N[\phi] \circ_{\cat C} \psi \equiv I_N[\phi \circ_{Q} \psi] : \alpha' \to_{\cat C} N[\beta]\]
  \item An ``elimination rule'' $\beta^o:\cat D;\beta : \cat D \pipe
    \cdot \vdash \epsilon_{N}[\beta] : N[\beta] \to_{Q} \beta$
  \item Such that $\psi : \alpha \to_{\cat C} N[\beta] \vdash \epsilon_N[\beta]
    \circ_{Q} \psi : \alpha \to_{Q} \beta$ is an inverse to
    $I_{N}[\phi]$ in that
    \begin{align*}
       I_n[\epsilon_N[\beta] \circ \psi/\phi] &= \psi \tag{$\eta$}\\
      \epsilon_N[\beta] \circ I_n[\phi] &= \phi \tag{$\beta$}
    \end{align*}
  \end{enumerate}
\end{definition}

Part of this equivalence is the \emph{Yoneda Lemma}, which we state
now in its internal, parameterized form.
The usual non-parameterized Yoneda lemma can be formed if we have a
unit sort.

\begin{lemma}[Parameterized Yoneda Lemma]
  Given categories $\cat C, \cat D$ and a profunctor $\alpha^o:\cat
  C;\beta : \cat D \vdash \alpha \to_{Q} \beta$ and a function
  $\beta : \cat D \vdash G[\beta] : \cat C$, then there is an
  isomorphism between
  \begin{enumerate}
  \item Terms $\cdot \vdash t : G[\beta] \to_{Q} \beta$
  \item left-homomorphisms $\phi : \alpha \to_{\cat C} G[\beta] \vdash
    u : \alpha \to_{Q} \beta$ i.e. they satisfy homomorphism on the
    left (the other side doesn't make sense if $G$ is not a functor):
    $u[\phi \circ \psi] = u[\phi] \circ \psi$
  \end{enumerate}
\end{lemma}
\begin{proof}
  First, the constructions
  \begin{enumerate}
  \item Given $t$, we define $u(t)$ to be
    \[\phi : \alpha \to_{\cat C} G[\beta] \vdash t \circ_{Q} \phi : \alpha \to_{Q} \beta\]

    Which is a left-homomorphism because:
    \[ (t \circ_{Q} \phi) \circ_{Q} \psi = t \circ_{Q} (\phi \circ_{\cat C} \psi)\]
  \item Given $u$, we define $t(u)$ to be
    \[ \cdot \vdash u[\id_{G[\beta]}/\phi] : G[\beta] \to_{Q} \beta \]
  \end{enumerate}
  Now we show they are inverse
  \begin{enumerate}
  \item First, the very easy case, $\cdot \vdash t(u(t)) : G[\beta] \to_{Q} \beta$:
    \begin{align*}
      t \circ_{Q} \id_{G[\beta]} &= t
    \end{align*}
    by the fact that $Q$ is a profunctor.
  \item Next, $\phi : \alpha \to_{\cat C} G[\beta] \vdash u(t(u)) : \alpha \to_{Q} \beta$:
    \begin{align*}
      u[\id_{G[\beta]}/\phi] \circ_{Q} \phi &= u[\id \circ_{\cat C} \phi/\phi]\\
      &= u[\phi/\phi]\\
      &= u
    \end{align*}
    which uses the fact that $u$ is a left-homomorphism.
  \end{enumerate}
\end{proof}

\begin{theorem}[Negative Types and Right Representables are Equivalent]
  For any profunctor $\alpha^o: \cat C; \beta : \cat D \pipe \alpha
  \to_{Q} \beta$, there is a bijection between
  \begin{enumerate}
  \item Right Represntables $\beta : \cat D \vdash G[\beta] : \cat C$ for $Q$.
  \item Negative Types $\beta : \cat D \vdash N[\beta] : \cat C$
    representing $Q$.
  \end{enumerate}
\end{theorem}
\begin{proof}
  \begin{enumerate}
  \item Given a right representable $G[\beta]$, we set $N(G)[\beta] =
    G[\beta]$, the introduction rule is the same and the elimination
    rule is given as in the Yoneda lemma and the inverse property
    follows by the Yoneda isomorphism and the fact that $I_G^{-1}$ is
    an inverse for $I_G$.
  \item Given a negative type $N[\beta]$ we set $G(N)[\beta] =
    N[\beta]$, the introduction rule is the same and the inverse
    introduction rule is given as in the Yoneda lemma.  We need to
    show that $N[\beta]$ has the structure of a functor and that
    $I_{N}$ and $I_{N}^{-1}$ are homomorphisms on the right with
    respect to that structure.  Define $N_1$ as follows:
    \begin{mathpar}
      \inferrule
          {\beta_1^o:\cat D;\beta_2:\cat D \vdash \psi \circ \epsilon : N[\beta_1/\beta] \to_{Q} \beta_2\\
            \phi : N[\beta_1/\beta] \to_{Q} \beta_2 \vdash I_N[\phi] : N[\beta_1/\beta] \to_{\cat C} N[\beta_2/\beta]
          }
          {\beta_1^o:\cat D;\beta_2:\cat D\pipe \psi : \beta_1 \to_{\cat D} \beta_2 \vdash I_N[\psi \circ \epsilon_{\beta_1}/\phi] : N[\beta_1/\beta] \to_{\cat C} N[\beta_2/\beta]}
    \end{mathpar}
    We need to show functoriality.
    For identity we have
    \begin{align*}
      I_N[\id_{\beta} \circ \epsilon_{\beta}/\phi] &= I_N[\epsilon_{\beta}]\\
      &= I_N[\epsilon \circ \id_{N[\beta]}]\\
      &= \id_{N[\beta]} \tag{$\eta$}
    \end{align*}
    For composition,
    \begin{align*}
      N_1[\theta] \circ N_1[\psi]
      &= I_N[\theta \circ \epsilon] \circ I_N[\psi \circ \epsilon]\\
      &= I_N[(\theta \circ \epsilon) \circ I_N[\psi \circ \epsilon]]\tag{left homomorphism}\\
      &= I_N[\theta \circ (\epsilon \circ I_N[\psi \circ \epsilon])]\\
      &= I_N[\theta \circ (\psi \circ \epsilon)] \tag{$\beta$}\\
      &= I_N[(\theta \circ \psi) \circ \epsilon]\\
      &= N_1[\theta \circ \psi]
    \end{align*}
    Next we show $I_N$ is a right homomorphism, the typing here is
    $\phi : \alpha \to_{Q} \beta_1, \theta : \beta_1 \to_{\cat D}
    \beta_2$.
    \begin{align*}
      N_1[\theta] \circ I_N[\phi] &= I_N[\theta \circ \epsilon] \circ I_N[\phi]\\
      &= I_N[\theta \circ \epsilon \circ I_N[\phi]]\tag{left homomorphism}\\
      &= I_N[\theta \circ \phi] \tag{$\beta$}
    \end{align*}
    and to show $I_N^{-1}$ is a right homomorphism under $\phi : \alpha \to_{\cat C}N[\beta_1], \theta : \beta_1 \to_{\cat D} \beta_2$
    \begin{align*}
      I_N^{-1}[N_1[\theta] \circ \phi] &= \epsilon \circ (N_1[\theta] \circ \phi) \tag{def}\\
      &= \epsilon \circ (I_N[\theta \circ \epsilon] \circ \phi)\tag{def}\\
      &= (\epsilon \circ I_N[\theta \circ \epsilon]) \circ \phi\tag{assoc}\\
      &= (\theta \circ \epsilon) \circ \phi\tag{$\beta$}\\
      &= \theta \circ (\epsilon \circ \phi)\tag{assoc}\\
      &= \theta \circ I_N^{-1}[\phi] \tag{def}
    \end{align*}
  \end{enumerate}

  Next we need to show that this is a \emph{bijection}.
  \begin{enumerate}
  \item Starting with a negative type $N[\beta]$, we recover the
    original $\epsilon$ by the Yoneda lemma.
  \item Starting with a right representable $G[\beta]$, we recover the
    original $I_N^{-1}$ by the Yoneda lemma. We need to show that the
    action of $G$ on arrows is the same as the one defined from $G$
    viewed as a negative type, which we will call $G_1'$:
    \begin{align*}
      G_1'[\theta] &= I_G[\theta \circ \epsilon]\\
      &= G_1[\theta] \circ I_G[\epsilon]\tag{right homomorphism}\\
      &= G_1[\theta] \circ I_G[\epsilon \circ \id]\\
      &= G_1[\theta] \circ \id\\
      &= G_1[\theta]
    \end{align*}
  \end{enumerate}
\end{proof}

\section{Specific Universal Properties: The Microcosm Principle}

While we have now proved a beautiful internal theorem in great
generality that has many useful instances in different models, we are
hard pressed to actually \emph{instantiate} the theorem in the syntax
itself because we can't really come up with any useful universal properties!
The reason is that Judgment Theory itself is too bare-bones.

For instance how would we say that a category $\cat C$ has a
\emph{terminal object}? Well, it would have to be in the first place a
\emph{single} object in $\cat C$, but so far our syntax only enables
us to talk about functions and functors. Well an object of $\cat C$ is
the same as a function from the unit sort, but so far our syntax only
has base sorts.

So we see that defining the terminal object, \emph{necessitates} some
notion of terminal object in our ``metatheory'': Judgment Theory.
This mysterious and pervasive aspect of higher category theory is
called the \emph{microcosm principle} because it says that in order to
discuss a property of a single object in a single category (the
microcosm), we need the same sort of object at the meta-level (the
macrocosm).
The adage here is ``As above, so below''.

That might all sound very spiritual, but we'll see that it's actually
quite a nice heuristic for formalizing universal properties in
internal category theory.
In the spirit of this heuristic, instead of first giving a bunch of
new type constructions for Judgment Theory and then applying them to
define universal properties, we will consider them in pairs, first
above, and then below.

\subsection{Terminal Sort/Terminal Object/Unit Type}

First we consider the terminal sort and then the idea of a terminal
object in an internal category.

\begin{figure}
  \begin{mathpar}
    \inferrule{~}{1 \sort}

    \inferrule*[right=1-Ty-Intro]{~}{\alpha : C \vdash () : 1}

    \inferrule*[right=1-Ty-$\eta$]{\alpha : C \vdash A : 1}{\alpha : C \vdash A = () : 1}\\

    \inferrule{~}{\alpha^o:C;\beta:D \pipe 1}

    \inferrule*[right=1-Tm-Intro]{~}{\Phi \vdash () : 1}
    
    \inferrule*[right=1-Tm-$\eta$]{\Phi \vdash t : 1}{\Phi \vdash t = () : 1}\\

    ()[\gamma] = ()\and 1[A/\alpha;B/\beta] = 1 \and ()[\phi] = ()
  \end{mathpar}
  \caption{Terminal Sort, Judgment}
\end{figure}

The rules say that there is a terminal sort $1$ that has an element
$()$ and everything is equal to that element.
Then we reproduce this at the level of judgments/terms: there is a
terminal judgment $1$ that has an element $()$ and everything is equal
to that element.

Next, the terminal sort trivially has a category structure using the
trivial judgment as its hom set:

\begin{definition}[Terminal Category]
  The terminal category $\cat 1$ consists of
  \begin{enumerate}
  \item Its object sort is $1$
  \item Its arrow judgment is $\alpha^o:1;\alpha:1 \pipe 1$
  \item Its identity arrow is given by $\alpha^o;\alpha \pipe \cdot \vdash () : 1$
  \item Composition is defined by $\phi : 1, \psi : 1 \vdash () : 1$
  \item Associativity and unitality are trivial by \textsc{1-$\eta$}
  \end{enumerate}
\end{definition}

\begin{definition}[Terminal Object Specification]
  In judgment type theory with a terminal sort/judgment, we can define
  for any category $\cat C$ a profunctor $\alpha^o:\cat C;\beta : \cat
  1 \pipe 1$, which specifies a terminal object.
\end{definition}

Now let's instantiate the definition for the terminal object defined
as a negative type and as a representable and see how it reproduces
the standard type-theoretic and category-theoretic definitions.

A representation of $\alpha^o:\cat C; \beta : \cat 1 \pipe 1$ consists
of a functor $\beta : \cat 1 \vdash 1_{\cat C} : \cat C$, an introduction rule
\[ \phi : 1 \vdash I_{1}[\phi] : \alpha \to_{\cat C} 1_{\cat C}[\beta] \]
satisfying $I_{1}[\phi] \circ \gamma =I_{1}[\phi \circ \gamma]$ and an
inverse $\psi : \alpha \to_{\cat C} 1_{\cat C}[\beta] \vdash
I_{1}^{-1}[\psi] : 1$ which by \textsc{1-$\eta$} is equal to $()$ and
therefore every $t : \alpha \to_{\cat C} 1_{\cat C}[\beta]$ is equal
to $I_{1}[\phi]$. In light of this it would be appropriate to write
$I_1[\phi]$ as $()$ and then the left-homomorphism property is $()
\circ \gamma = ()$, which is precisely the definition of substitution.

This alternate syntax makes even more sense in light of the negative
type presentation. A negative type satisfying the terminal object
specification consists of a functor $1_{\cat C}$ as above and an
introduction rule as above and an elimination form $\vdash \epsilon :
1$, which is trivial.

\subsection{Products}

Next the product

\begin{figure}
  \begin{mathpar}
    
    \inferrule{C \sort \and D\sort}{C \times D \sort}

    \inferrule
    {\alpha : C \vdash A_1 : D_1 \and \alpha : C \vdash A_2 : D_2}
    {\alpha : C \vdash (A_1,A_2) : D_1 \times D_2}

    (A_1,A_2)[B/\alpha] = (A_1[B/\alpha], A_2[B/\alpha])
     
    (\pi_i A)[B/\alpha] = \pi_i A[B/\alpha]

    \inferrule{\alpha : C \vdash A : D_1 \times D_2}{\alpha : C \vdash \pi_i A : D_i}

    \inferrule*[right=$\times-\beta$]{~}{\pi_i(A_1,A_2) = A_i}

    \inferrule*{\alpha : C \vdash A : D_1 \times D_2}{\alpha : C \vdash A = (\pi_1 A, \pi_2 A) : D_1\times D_2}\\

    \inferrule
    {\alpha^o: C;\beta : D \pipe R_1 \and \alpha^o: C;\beta : D \pipe R_2}
    {\alpha^o: C;\beta : D \pipe R_1 \times R_2}

    (R_1 \times R_2)[A/\alpha;B/\beta] = (R_1[A/\alpha;B/\beta] \times R_2[A/\alpha;B/\beta])

    \inferrule
    {\Phi \vdash t_1 : R_1 \and \Phi \vdash t_2 : R_2}
    {\Phi \vdash (t_1,t_2) : R_1 \times R_2}

    (t_1,t_2)[\phi] = (t_1[\phi], t_2[\phi])

    \inferrule
    {\Phi \vdash u : R_1 \times R_2}
    {\Phi \vdash \pi_i u : R_i}

    (\pi_i u)[\phi] = \pi_i u[\phi] 

    \inferrule{~}{\pi_i (t_1,t_2) = t_i}

    \inferrule{\Phi \vdash t : R_1 \times R_2}{t = (\pi_1 t, \pi_2 t)}
  \end{mathpar}
  \caption{Product Sort, Judgment}
\end{figure}

First the product category

\begin{definition}[Product category]
  For any categories $\cat C_1$, $\cat C_2$ we can form the product
  category whose sort of objects is $\cat C_1 \times \cat C_2$, whose
  arrow judgment is $\alpha^o : \cat C_1 \times \cat C_2;\alpha \pipe
  (\pi_1 \alpha \to_{\cat C_1} \pi_1 \alpha) \times (\pi_2 \alpha
  \to_{\cat C_2} \pi_2 \alpha)$. Identity is given by $\alpha^o : \cat
  C_1 \times \cat C_2;\alpha\pipe\cdot \vdash (\id_{\pi_1 \alpha},
  \id_{\pi_2 \alpha}) : (\pi_1 \alpha \to_{\cat C_1} \pi_1 \alpha)
  \times (\pi_2 \alpha \to_{\cat C_2} \pi_2 \alpha)$ and composition
  by
  \[
  \phi %: (\pi_1 \alpha_0 \to_{\cat C_1} \pi_1 \alpha_1) \times (\pi_2 \alpha_0 \to_{\cat C_2} \pi_2 \alpha_1)
  ,
  \psi %: (\pi_1 \alpha_1 \to_{\cat C_1} \pi_1 \alpha_2) \times (\pi_2 \alpha_1 \to_{\cat C_2} \pi_2 \alpha_2)
  \vdash ((\pi_1 \phi) \circ (\pi_1 \psi), (\pi_2 \psi) \circ (\pi_2 \phi)) :
  (\pi_1 \alpha_0 \to_{\cat C_1} \pi_1 \alpha_2) \times (\pi_2 \alpha_0 \to_{\cat C_2} \pi_2 \alpha_2)  
  \]
  unitality, associativity follow from the same properties of $\cat C_1,\cat C_2$
\end{definition}

\begin{definition}[Product Functor Specification]
  For any category $\cat C$, we can specify the product functor by
  \begin{enumerate}
  \item The span is $\alpha^o:\cat C; \beta : \cat C \times \cat C \pipe (\alpha \to_{\cat C} \pi_1 \beta) \times (\alpha \to_{\cat C} \pi_2 \beta)$
  \item Left Composition is defined as
    \[ \phi, \psi \vdash (\pi_1 \phi \circ \psi, \pi_2 \phi \circ \psi)\]
  \item Left unitality:
    \begin{align*}
      (\pi_1 \phi \circ \id, \pi_2 \phi \circ \id)
      &= (\pi_1 \phi, \pi_2 \phi)\\
      &= \phi\tag{$\times-eta$}
    \end{align*}
  \item Left associativity:
    \begin{align*}
      (\phi \circ \psi) \circ \psi'
      &= (\pi_1 \phi \circ \psi, \pi_2 \phi \circ \psi) \circ \psi'\\
      &= (\pi_1 (\pi_1 \phi \circ \psi, \pi_2 \phi \circ \psi) \circ \psi',
      \pi_2 (\pi_1 \phi \circ \psi, \pi_2 \phi \circ \psi) \circ \psi')\\
      &= ((\pi_1 \phi \circ \psi) \circ \psi', (\pi_2 \phi \circ \psi) \circ \psi')\\
      &= (\pi_1 \phi \circ (\psi \circ \psi'), \pi_2 \phi \circ (\psi \circ \psi'))\\
      &= \phi \circ (\psi \circ \psi')
    \end{align*}
  \item Right composition is defined as
    \[ \phi, \theta \vdash (\pi_1 \theta \circ \pi_1 \phi, \pi_2 \theta \circ \pi_2 \phi) \]
  \item Right unitality:
    \begin{align*}
      (\pi_1 (\id,\id) \circ \pi_1 \phi, \pi_2 (\id,\id) \circ \pi_2 \phi)
      &= (\id \circ \pi_1 \phi, \id \circ \pi_2 \phi) \tag{$\times-\beta$}\\
      &= (\pi_1 \phi, \id \circ \pi_2 \phi)\\
      &= \phi \tag{$\times-\eta$}
    \end{align*}
  \item Right associativity
    \begin{align*}
      \theta' \circ (\theta \circ \phi)
      &= \theta' \circ (\pi_1 \theta \circ \pi_1 \phi, \pi_2 \theta \circ \pi_2 \phi)\\
      &= (\pi_1 \theta' \circ \pi_1(\pi_1 \theta \circ \pi_1 \phi, \pi_2 \theta \circ \pi_2 \phi),
      \pi_2 \theta' \circ \pi_2(\pi_1 \theta \circ \pi_1 \phi, \pi_2 \theta \circ \pi_2 \phi))\\
      &= (\pi_1 \theta' \circ (\pi_1 \theta \circ \pi_1 \phi), \pi_2 \theta' \circ (\pi_2 \theta \circ \pi_2 \phi))\\
      &= ((\pi_1 \theta' \circ \pi_1 \theta) \circ \pi_1 \phi, (\pi_2 \theta' \circ \pi_2 \theta) \circ \pi_2 \phi)\\
      &= (\pi_1(\theta' \circ \theta) \circ \pi_1 \phi, \pi_2(\theta' \circ \theta) \circ \pi_2 \phi)\\
      &= (\theta' \circ \theta) \circ \phi \\
    \end{align*}
  \end{enumerate}
\end{definition}

\section{Equipment of Internal Categories}

Next we show that internal categories provide us with our first
\emph{model} of judgment type theory by interpreting sorts as
categories, functions as functors, spans as profunctors and 2-cells as
natural transformations.
%
Furthermore, this model can be seen as an \emph{implementation} of
Hom-sets, we translate Judgment type theory with hom sets into
categories internal to judgmental type theory \emph{without} hom sets:
the home sets come from the category structure.

The interpretation of hom-formation and -introduction is obvious, but
elim is more interesting...

\section{Monads and Multicategories}

It is well-established at this point that defining enriched
multicategories requires an appropriate notion of \emph{monad} on the
enriching ``category''. As such we need to extend our language to be
``monadic'' in some way.
However, there can be many monads on a single virtual equipment, so in
order to introduce a monad by a universal property, we need to enrich
the judgmental structure of the theory.

\begin{figure}
  \begin{mathpar}
  \alpha : C \vdash \vec A \div D

  \Phi \vdash \vec t \div R

  \inferrule*[right=*]
  {\alpha : C \vdash B : D \and \beta : D \vdash \vec A \div E}
  {\alpha : C \vdash \vec A[B/\beta] \div E}

  \inferrule*[right=ret]
  {\alpha : C \vdash A : D}
  {\alpha : C \vdash [A] \div D}

  \inferrule*[right=kleisli]
  {\alpha : C \vdash \vec A \div D \and \beta : D \vdash \vec B \div E}
  {\alpha : C \vdash \for [\beta] \in \vec A.~\vec B \div E}
  
  \inferrule{~}{\for [\beta] \in [A].~\vec A = \vec A[A/\beta]}

  \inferrule{~}{\for [\beta] \in \vec A.~[\beta] = \vec A}

  \inferrule*[right=Kleisli-Restrict]
  {\alpha' : C' \vdash \vec A \div C\and
    \beta': D' \vdash \vec B \div D\and
    \alpha^o : C;\beta: D \pipe R}
  {\alpha'^o;\beta' \pipe \for [\alpha;\beta] \in \vec A\wr\vec B.~R}

  \end{mathpar}
  \caption{Virtually Monadal Judgment Theory (additions to judgment theory)}
\end{figure}


\section{Semantics of Judgment Theory}

\end{document}

%% Local Variables:
%% compile-command: "pdflatex syntax.tex"
%% End:
